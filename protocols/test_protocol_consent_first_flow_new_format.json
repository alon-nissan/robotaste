{
    "protocol_id": "protocol_consent_first_flow",
    "name": "Consent-First Flow: Four-Cycle Sugar Calibration",
    "description": "4-cycle protocol with consent-first flow (WAITING → CONSENT → EXPERIMENT_LOOP → REGISTRATION → COMPLETE). Testing sugar concentrations at 0, 25, 50, and 75 mM with automated pump control in burst mode.",
    "version": "1.0",
    "schema_version": "1.0",
    "created_by": "Researcher",
    "created_at": "2026-01-21T00:00:00Z",
    "tags": [
        "calibration",
        "sugar",
        "predetermined_randomized",
        "latin_square",
        "automated",
        "consent_first"
    ],
    "ingredients": [
        {
            "name": "Sugar",
            "min_concentration": 0.0,
            "max_concentration": 100.0,
            "unit": "mM",
            "molecular_weight": 342.3,
            "stock_concentration_mM": 200.0
        },
        {
            "name": "Water",
            "min_concentration": 0.0,
            "max_concentration": 1.0,
            "unit": "mM",
            "molecular_weight": 18.015,
            "stock_concentration_mM": 0.001,
            "is_diluent": true
        }
    ],
    "pump_config": {
        "enabled": true,
        "serial_port": "/dev/cu.PL2303G-USBtoUART120",
        "baud_rate": 19200,
        "pumps": [
            {
                "address": 0,
                "ingredient": "Sugar",
                "syringe_diameter_mm": 29.0,
                "max_rate_ul_min": 100000,
                "stock_concentration_mM": 200.0,
                "description": "BD 50mL syringe with sugar stock solution (200 mM)"
            },
            {
                "address": 1,
                "ingredient": "Water",
                "syringe_diameter_mm": 29.0,
                "max_rate_ul_min": 100000,
                "stock_concentration_mM": 0.0,
                "description": "BD 50mL syringe with plain water for dilution"
            }
        ],
        "total_volume_ml": 10.0,
        "dispensing_rate_ul_min": 80000,
        "simultaneous_dispensing": true,
        "use_burst_mode": true
    },
    "consent_form": {
        "explanation": "You are invited to participate in a sugar taste calibration study. This study aims to understand individual differences in taste perception by testing your responses to different concentrations of sugar solutions.\n\nProcedure: You will taste 4 different sugar solutions and rate their intensity on a continuous scale. The entire session will take approximately 10-15 minutes.\n\nRisks: There are minimal risks associated with this study. You will be consuming small amounts of sugar solutions, which should pose no risk to healthy individuals.\n\nBenefits: You will contribute to scientific understanding of taste perception. There is no direct benefit to you.\n\nConfidentiality: All data collected will be anonymized and stored securely. Your personal information will not be shared with third parties.",
        "contact_info": "For questions about this study, please contact: researcher@example.com\n\nIf you have questions about your rights as a research participant, please contact the Institutional Review Board at: irb@example.edu",
        "medical_disclaimers": [
            "You should not participate if you have diabetes or other conditions affecting sugar metabolism",
            "Please inform the researcher of any food allergies or dietary restrictions",
            "You must be at least 18 years old to participate in this study"
        ],
        "consent_label": "I have read and understood the information above, and I agree to participate in this study"
    },
    "sample_selection_schedule": [
        {
            "cycle_range": {
                "start": 1,
                "end": 4
            },
            "mode": "predetermined_randomized",
            "sample_bank": {
                "samples": [
                    {
                        "id": "A",
                        "concentrations": {
                            "Sugar": 0.0
                        },
                        "label": "No Sugar"
                    },
                    {
                        "id": "B",
                        "concentrations": {
                            "Sugar": 25.0
                        },
                        "label": "Low Sugar"
                    },
                    {
                        "id": "C",
                        "concentrations": {
                            "Sugar": 50.0
                        },
                        "label": "Medium Sugar"
                    },
                    {
                        "id": "D",
                        "concentrations": {
                            "Sugar": 75.0
                        },
                        "label": "High Sugar"
                    }
                ],
                "design_type": "latin_square",
                "constraints": {
                    "prevent_consecutive_repeats": true,
                    "ensure_all_used_before_repeat": true
                }
            }
        }
    ],
    "questionnaire": {
        "name": "Intensity Scale (Continuous)",
        "description": "Continuous 9-point intensity scale for measuring attribute strength.",
        "version": "1.0",
        "questions": [
            {
                "id": "sweetness_intensity",
                "type": "slider",
                "label": "How sweet is this sample?",
                "help_text": "Rate the sweetness intensity from 1 (No sweet) to 9 (Very strong).",
                "scale_labels": {
                    "1": "No sweet",
                    "3": "Light",
                    "5": "Medium",
                    "7": "Strong",
                    "9": "Very strong"
                },
                "min": 1.0,
                "max": 9.0,
                "default": 5.0,
                "step": 0.01,
                "required": true,
                "display_type": "slider_continuous"
            }
        ],
        "bayesian_target": {
            "variable": "sweetness_intensity",
            "transform": "identity",
            "higher_is_better": true,
            "description": "Measure sweetness intensity.",
            "expected_range": [1.0, 9.0],
            "optimal_threshold": 5.0
        }
    },
    "bayesian_optimization": {
        "enabled": false
    },
    "phase_sequence": {
        "phases": [
            {
                "phase_id": "waiting",
                "phase_type": "builtin",
                "required": true
            },
            {
                "phase_id": "consent",
                "phase_type": "builtin",
                "required": true
            },
            {
                "phase_id": "experiment_loop",
                "phase_type": "loop",
                "required": true
            },
            {
                "phase_id": "registration",
                "phase_type": "builtin",
                "required": true
            },
            {
                "phase_id": "complete",
                "phase_type": "builtin",
                "required": true
            }
        ]
    },
    "stopping_criteria": {
        "max_cycles": 4,
        "min_cycles": 4
    },
    "loading_screen": {
        "message": "Please rinse your mouth with water while the robot prepares the next sugar sample. (Sample order randomized per session)",
        "duration_seconds": 10,
        "use_dynamic_duration": true,
        "show_progress": true,
        "show_cycle_info": true,
        "message_size": "large"
    },
    "data_collection": {
        "track_trajectory": true,
        "track_interaction_times": true,
        "collect_demographics": true,
        "custom_metadata": {}
    }
}
