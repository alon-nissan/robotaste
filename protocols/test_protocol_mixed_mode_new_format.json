{
  "protocol_id": "proto_test_mixed_001",
  "name": "Test Protocol: Mixed-Mode Sugar-Salt",
  "description": "Test protocol with predetermined calibration, user exploration, and BO optimization phases",
  "version": "1.0",
  "schema_version": "1.0",
  "created_by": "Developer A",
  "created_at": "2026-01-01T00:00:00Z",
  "tags": ["test", "mixed-mode", "binary"],
  "ingredients": [
    {
      "name": "Sugar",
      "min_concentration": 0.73,
      "max_concentration": 73.0,
      "unit": "mM",
      "molecular_weight": 342.3,
      "stock_concentration_mM": 1000.0
    },
    {
      "name": "Salt",
      "min_concentration": 0.10,
      "max_concentration": 10.0,
      "unit": "mM",
      "molecular_weight": 58.44,
      "stock_concentration_mM": 1000.0
    }
  ],
  "pump_config": {
    "enabled": true,
    "serial_port": "/dev/cu.PL2303G-USBtoUART120",
    "baud_rate": 19200,
    "pumps": [
      {
        "address": 0,
        "ingredient": "Sugar",
        "syringe_diameter_mm": 26.7,
        "max_rate_ul_min": 100000,
        "stock_concentration_mM": 1000.0,
        "description": "BD 50mL syringe with sugar stock"
      },
      {
        "address": 1,
        "ingredient": "Salt",
        "syringe_diameter_mm": 26.7,
        "max_rate_ul_min": 100000,
        "stock_concentration_mM": 1000.0,
        "description": "BD 50mL syringe with salt stock"
      }
    ],
    "total_volume_ml": 10.0,
    "dispensing_rate_ul_min": 60000,
    "simultaneous_dispensing": true
  },
  "instructions_screen": {
    "title": "Instructions",
    "text": "**Welcome to the Sugar-Salt Optimization Experiment!**\n\nIn this experiment you will taste liquid samples containing different combinations of sugar and salt.\n\nThe experiment has three phases:\n1. **Calibration** (first 2 samples): Pre-determined samples to establish a baseline.\n2. **Exploration** (next 3 samples): You choose the concentrations using the grid interface.\n3. **Optimization** (remaining samples): The system will suggest samples based on your preferences.\n\nAfter each sample, rate how much you liked it on the scale provided.\nPlease rinse your mouth with water between samples.",
    "confirm_label": "I understand the instructions.",
    "button_label": "Start Experiment"
  },
  "sample_selection_schedule": [
    {
      "cycle_range": {"start": 1, "end": 2},
      "mode": "predetermined",
      "predetermined_samples": [
        {"cycle": 1, "concentrations": {"Sugar": 10.0, "Salt": 2.0}},
        {"cycle": 2, "concentrations": {"Sugar": 40.0, "Salt": 6.0}}
      ]
    },
    {
      "cycle_range": {"start": 3, "end": 5},
      "mode": "user_selected",
      "config": {
        "interface_type": "grid",
        "randomize_start": true
      }
    },
    {
      "cycle_range": {"start": 6, "end": 15},
      "mode": "bo_selected",
      "config": {
        "show_bo_suggestion": true,
        "allow_override": true,
        "auto_accept_suggestion": false
      }
    }
  ],
  "questionnaire": {
    "name": "Hedonic Test (Continuous)",
    "description": "Continuous 9-point hedonic scale with 0.01 precision for detailed preference measurement",
    "version": "2.0",
    "citation": "Peryam & Pilgrim (1957) - Hedonic scale method of measuring food preferences",
    "questions": [
      {
        "id": "overall_liking",
        "type": "slider",
        "label": "How much do you like this sample?",
        "help_text": "Rate your overall liking from 1.00 (Dislike Extremely) to 9.00 (Like Extremely)",
        "scale_labels": {
          "1": "Dislike Extremely",
          "2": "Dislike Very Much",
          "3": "Dislike Moderately",
          "4": "Dislike Slightly",
          "5": "Neither Like nor Dislike",
          "6": "Like Slightly",
          "7": "Like Moderately",
          "8": "Like Very Much",
          "9": "Like Extremely"
        },
        "min": 1.0,
        "max": 9.0,
        "default": 5.0,
        "step": 0.01,
        "required": true,
        "display_type": "slider_continuous",
        "color_scale": "red_to_green"
      }
    ],
    "bayesian_target": {
      "variable": "overall_liking",
      "transform": "identity",
      "higher_is_better": true,
      "description": "Maximize overall liking score (1.0-9.0 continuous scale)",
      "expected_range": [1.0, 9.0],
      "optimal_threshold": 7.0
    }
  },
  "bayesian_optimization": {
    "enabled": true,
    "min_samples_for_bo": 3,
    "acquisition_function": "ei",
    "ei_xi": 0.01,
    "ucb_kappa": 2.0,
    "adaptive_acquisition": true,
    "exploration_budget": 0.25,
    "xi_exploration": 0.1,
    "xi_exploitation": 0.01,
    "kappa_exploration": 3.0,
    "kappa_exploitation": 1.0,
    "kernel_nu": 2.5,
    "alpha": 0.001,
    "n_restarts_optimizer": 10
  },
  "phase_sequence": {
    "phases": [
      {"phase_id": "waiting", "phase_type": "builtin", "required": true},
      {"phase_id": "registration", "phase_type": "builtin", "required": false},
      {"phase_id": "instructions", "phase_type": "builtin", "required": true},
      {"phase_id": "experiment_loop", "phase_type": "loop", "required": true}
    ]
  },
  "stopping_criteria": {
    "mode": "suggest_auto",
    "min_cycles": 15,
    "max_cycles": 30,
    "convergence_detection": true,
    "early_termination_allowed": true,
    "ei_threshold": 0.001,
    "stability_threshold": 0.05
  },
  "loading_screen": {
    "duration_seconds": 10,
    "use_dynamic_duration": true
  },
  "presentation": {
    "randomize_start": true,
    "show_cycle_counter": true,
    "show_convergence_indicator": true,
    "display_bo_predictions": true
  },
  "data_collection": {
    "track_trajectory": true,
    "track_interaction_times": true,
    "collect_demographics": true,
    "custom_metadata": {}
  }
}
